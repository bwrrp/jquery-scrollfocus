(function(h,g){function m(a){return 0===a.left&&0===a.top&&0===a.right&&0===a.bottom}function k(a){return 3===a.nodeType||4===a.nodeType}function n(a){var c=a.getBoundingClientRect();if(!m(c))return c;a=a.cloneRange();k(a.endContainer)&&a.endOffset===a.endContainer.length&&a.endContainer.length&&(a.setStart(a.endContainer,a.endOffset-1),c=a.getBoundingClientRect());for(;m(c);)k(a.endContainer)&&a.endOffset<a.endContainer.length?a.setEnd(a.endContainer,a.endOffset+1):1===a.endContainer.nodeType&&a.endOffset<
a.endContainer.childNodes.length?(c=a.endContainer.childNodes[a.endOffset],k(c)||1===c.nodeType?a.setEnd(c,0):a.setEnd(a.endContainer,a.endOffset+1)):k(a.endContainer)?a.setEndAfter(a.endContainer):a.selectNode(a.endContainer),c=a.getBoundingClientRect();a.detach();return c}function l(a,c){a.width===g&&(a.width=a.right===g?c.width():a.right-a.left);a.right===g&&(a.right=a.left+a.width);a.height===g&&(a.height=a.bottom===g?c.height():a.bottom-a.top);a.bottom===g&&(a.bottom=a.top+a.height)}function p(a,
c){if(c)for(var b=c.split(/\s+/),e=b.length-1;0<=e;--e)switch(b[e].toLowerCase()){case "left":a.right=a.left;a.width=0;break;case "right":a.left=a.right;a.width=0;break;case "top":a.bottom=a.top;a.height=0;break;case "bottom":a.top=a.bottom,a.height=0}}var q={point:"left top"};h.fn.scrollFocus=function(a){var c=a&&a.target;c||(c=a,a={});!c||c.jquery&&!c.length||(a=h.extend({},q,a),h(this.get().reverse()).each(function(){var b,e,g=h(this);b=this.ownerDocument||this;var d=h.isWindow(this)?this:b.defaultView,
f=d.pageXOffset,k=d.pageYOffset;c.startContainer?(b=n(c),e={left:b.left+f,right:b.right+f,top:b.top+k,bottom:b.bottom+k}):(c.jquery||(c=h(c)),e=c.offset());l(e,c);a.viewport?(b={left:a.viewport.left,right:a.viewport.right,top:a.viewport.top,bottom:a.viewport.bottom,width:a.viewport.width,height:a.viewport.height},l(b,h(d)),b.left+=f,b.right+=f,b.top+=k,b.bottom+=k):b=h.isWindow(this)?{left:d.pageXOffset,top:d.pageYOffset}:g.offset();l(b,g);d=b;if(f=a.viewport&&a.viewport.padding)d.top+=f,d.left+=
f,d.bottom-=f,d.right-=f,d.width-=2*f,d.height-=2*f;p(e,a.point);p(b,a.toPoint);d=b;b=e.left<d.left?e.right-d.left:e.left-d.right;f=e.top<d.top?e.bottom-d.top:e.top-d.bottom;b=e.left<d.left?Math.min(b,0):Math.max(b,0);e=e.top<d.top?Math.min(f,0):Math.max(f,0);g.scrollLeft(g.scrollLeft()+b);g.scrollTop(g.scrollTop()+e)}))};h.fn.scrollFocus.getRangeBounds=n})(jQuery);