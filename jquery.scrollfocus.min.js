(function(n){function k(a,b,d){arguments.length&&(this.left=a,this.top=b,this.offsetParent=d)}function g(a,b,d,c,e){arguments.length&&(this.origin=new k(a,b,e&&e.origin),this.width=d,this.height=c,this.parentBox=e)}function h(a){g.call(this,0,0,0,0,new m(a));this.element=a;this.refresh()}function m(a){var b=a.offsetParent&&a.offsetParent!==a.ownerDocument.body?new h(a.offsetParent):new l(a.ownerDocument);g.call(this,a.offsetLeft,a.offsetTop,a.offsetWidth,a.offsetHeight,b);this.element=a}function l(a){g.call(this,
0,0,0,0,null);this.document=a;this.refresh()}function q(a){return 0===a.left&&0===a.top&&0===a.right&&0===a.bottom}function p(a){return 3===a.nodeType||4===a.nodeType}function r(a){var b=a.getBoundingClientRect();if(!q(b))return b;a=a.cloneRange();p(a.endContainer)&&(a.endOffset===a.endContainer.length&&a.endContainer.length)&&(a.setStart(a.endContainer,a.endOffset-1),b=a.getBoundingClientRect());for(;q(b);)p(a.endContainer)&&a.endOffset<a.endContainer.length?a.setEnd(a.endContainer,a.endOffset+1):
1===a.endContainer.nodeType&&a.endOffset<a.endContainer.childNodes.length?(b=a.endContainer.childNodes[a.endOffset],p(b)||1===b.nodeType?a.setEnd(b,0):a.setEnd(a.endContainer,a.endOffset+1)):p(a.endContainer)?a.setEndAfter(a.endContainer):a.selectNode(a.endContainer),b=a.getBoundingClientRect();a.detach();return b}k.prototype.absolute=function(){if(!this.offsetParent)return this;var a=this.offsetParent.absolute();return new k(a.left+this.left,a.top+this.top,null)};k.prototype.relativeTo=function(a){var b=
a?a.absolute():{left:0,top:0},d=this.absolute();return new k(d.left-b.left,d.top-b.top,a)};g.prototype.topLeft=function(){return this.origin};g.prototype.bottomRight=function(){return new k(this.width,this.height,this.origin)};g.prototype.relativeTo=function(a){var b=this.origin.relativeTo(a&&a.origin);return new g(b.left,b.top,this.width,this.height,a)};h.prototype=new g;h.prototype.constructor=h;h.prototype.refresh=function(){this.origin.left=-this.element.scrollLeft;this.origin.top=-this.element.scrollTop;
this.width=this.element.scrollWidth;this.height=this.element.scrollHeight};h.prototype.scrollTo=function(a,b){this.element.scrollTop=b;this.element.scrollLeft=a;this.refresh()};m.prototype=new g;m.prototype.constructor=m;l.prototype=new g;l.prototype.constructor=l;l.prototype.refresh=function(){var a=this.document.defaultView,b=this.document.documentElement;this.origin.left=-a.pageXOffset;this.origin.top=-a.pageYOffset;this.width=b.offsetWidth;this.height=b.offsetHeight};l.prototype.scrollTo=function(a,
b){this.document.defaultView.scrollTo(a,b);this.refresh()};var s={point:"left top"};n.fn.scrollFocus=function(a){n(this).each(function(){var b=a.target;if(a.startContainer||1===a.nodeType)b=a,a={};a=n.extend({},s,a);if(b.startContainer){var d=b,b=r(d),d=d.commonAncestorContainer;1!==d.nodeType&&(d=d.parentNode);b=(new g(b.left,b.top,b.right-b.left,b.bottom-b.top,null)).relativeTo(new h(d))}else b=new m(b);var d=b,b=1===this.nodeType?new h(this):new l(this.document),c=b.parentBox;c||(c=this.document?
this.document:this.ownerDocument||this,c=new g(0,0,c.documentElement.clientWidth,c.documentElement.clientHeight,null));if(a.viewport)var e=a.viewport,f=e.padding||0,c=new g(e.left+f||0,e.top+f||0,(e.width||(c?c.width:scrollable.width))-2*f,(e.height||(c?c.height:scrollable.height))-2*f,c);if(a.toPoint){f=a.toPoint;e=new g(0,0,c.width,c.height,c);for(f=f.split(/\s+/);f.length;)switch(f.pop().toLowerCase()){case "left":e.origin.left=0;e.width=0;break;case "top":e.origin.top=0;e.height=0;break;case "right":e.origin.left=
c.width;e.width=0;break;case "bottom":e.origin.top=c.height,e.height=0}c=e}f=a.point;e=new k(0,0,d.origin);if("string"===typeof f)for(f=f.split(/\s+/);f.length;)switch(f.pop().toLowerCase()){case "left":e.left=0;break;case "top":e.top=0;break;case "right":e.left=d.width;break;case "bottom":e.top=d.height;break;case "center":e.left=d.width/2;break;case "middle":e.top=d.height/2}d=c;c=e.relativeTo(d.origin);0<=c.left&&c.left<d.width&&(c.left=0);0<=c.top&&c.top<d.height&&(c.top=0);c.left>=d.width&&(c.left-=
d.width);c.top>=d.height&&(c.top-=d.height);b.scrollTo(-b.origin.left+c.left,-b.origin.top+c.top)})};n.fn.scrollFocus.getRangeBounds=r})(jQuery);